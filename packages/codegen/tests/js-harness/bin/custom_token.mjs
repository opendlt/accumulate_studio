/**
 * Custom Token Issuance
 * Generated by Accumulate Studio
 * Network: devnet
 *
 * Install: npm install accumulate.js
 * Run with: node script.mjs
 */

import {
    Accumulate,
    SmartSigner,
    TxBody,
    Ed25519KeyPair,
    KERMIT_V2,
    KERMIT_V3,
} from "accumulate.js";

const V2_ENDPOINT = process.env.ACCUMULATE_V2_URL || KERMIT_V2;
const V3_ENDPOINT = process.env.ACCUMULATE_V3_URL || KERMIT_V3;

async function main() {
    const client = Accumulate.custom(V2_ENDPOINT, V3_ENDPOINT);
    const txIds = [];
    try {


        // =========================================================
        // CreateToken (Action: CreateToken)
        // =========================================================
        const createTokenSigner = new SmartSigner(client, createTokenKp.toKey(), createTokenLid);
        const createTokenResult = await createTokenSigner.signSubmitAndWait(
            "adi_url",
            TxBody.createToken(
                "{adi_url}/{token_symbol}",
                "token_symbol",
                token_precision,
            ),
        );
        if (createTokenResult.success) {
            console.log(`CreateToken SUCCESS - TxID: ${createTokenResult.txid}`);
            if (createTokenResult.txid) txIds.push(["CreateToken", createTokenResult.txid]);
        } else {
            console.log(`CreateToken FAILED: ${createTokenResult.error}`);
        }


        // =========================================================
        // IssueTokens (Action: IssueTokens)
        // =========================================================
        const issueTokensSigner = new SmartSigner(client, issueTokensKp.toKey(), issueTokensLid);
        const issueTokensResult = await issueTokensSigner.signSubmitAndWait(
            "{adi_url}/{token_symbol}",
            TxBody.issueTokens(
                "recipient_url",
                "initial_issue_amount",
            ),
        );
        if (issueTokensResult.success) {
            console.log(`IssueTokens SUCCESS - TxID: ${issueTokensResult.txid}`);
            if (issueTokensResult.txid) txIds.push(["IssueTokens", issueTokensResult.txid]);
        } else {
            console.log(`IssueTokens FAILED: ${issueTokensResult.error}`);
        }


        // =========================================================
        // QueryAccount (QueryAccount)
        // =========================================================
        const queryTokenResult = await client.queryAccount("{adi_url}/{token_symbol}");
        console.log(`Account state: ${JSON.stringify(queryTokenResult, null, 2)}`);


        // =========================================================
        // SendTokens (Action: SendTokens)
        // =========================================================
        const sendTokensSigner = new SmartSigner(client, sendTokensKp.toKey(), sendTokensLid);
        const sendTokensResult = await sendTokensSigner.signSubmitAndWait(
            "recipient_url",
            TxBody.sendTokensSingle(
                "recipient_url",
                "100.00000000",
            ),
        );
        if (sendTokensResult.success) {
            console.log(`SendTokens SUCCESS - TxID: ${sendTokensResult.txid}`);
            if (sendTokensResult.txid) txIds.push(["SendTokens", sendTokensResult.txid]);
        } else {
            console.log(`SendTokens FAILED: ${sendTokensResult.error}`);
        }


        console.log("\n========== Transaction Summary ==========");
        for (const [label, txid] of txIds) {
            console.log(`  ${label}: ${txid}`);
        }
        console.log("Flow completed successfully!");
    } catch (err) {
        console.error("Flow failed:", err);
    }
}

main().catch(console.error);
