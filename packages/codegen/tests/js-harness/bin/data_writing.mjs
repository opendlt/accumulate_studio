/**
 * Data Storage
 * Generated by Accumulate Studio
 * Network: devnet
 *
 * Install: npm install accumulate.js
 * Run with: node script.mjs
 */

import {
    Accumulate,
    SmartSigner,
    TxBody,
    Ed25519KeyPair,
    KERMIT_V2,
    KERMIT_V3,
} from "accumulate.js";

const V2_ENDPOINT = process.env.ACCUMULATE_V2_URL || KERMIT_V2;
const V3_ENDPOINT = process.env.ACCUMULATE_V3_URL || KERMIT_V3;

async function main() {
    const client = Accumulate.custom(V2_ENDPOINT, V3_ENDPOINT);
    const txIds = [];
    try {


        // =========================================================
        // CreateDataAccount (Action: CreateDataAccount)
        // =========================================================
        const createDataAccountSigner = new SmartSigner(client, createDataAccountKp.toKey(), createDataAccountLid);
        const createDataAccountResult = await createDataAccountSigner.signSubmitAndWait(
            "adi_url",
            TxBody.createDataAccount("{adi_url}/{data_account_name}"),
        );
        if (createDataAccountResult.success) {
            console.log(`CreateDataAccount SUCCESS - TxID: ${createDataAccountResult.txid}`);
            if (createDataAccountResult.txid) txIds.push(["CreateDataAccount", createDataAccountResult.txid]);
        } else {
            console.log(`CreateDataAccount FAILED: ${createDataAccountResult.error}`);
        }


        // =========================================================
        // WriteData (Action: WriteData)
        // =========================================================
        const writeDataSigner = new SmartSigner(client, writeDataKp.toKey(), writeDataLid);
        const writeDataResult = await writeDataSigner.signSubmitAndWait(
            "{adi_url}/{data_account_name}",
            TxBody.writeData([
                "data_content",
            ]),
        );
        if (writeDataResult.success) {
            console.log(`WriteData SUCCESS - TxID: ${writeDataResult.txid}`);
            if (writeDataResult.txid) txIds.push(["WriteData", writeDataResult.txid]);
        } else {
            console.log(`WriteData FAILED: ${writeDataResult.error}`);
        }


        // =========================================================
        // QueryAccount (QueryAccount)
        // =========================================================
        const queryAccountResult = await client.queryAccount("{adi_url}/{data_account_name}");
        console.log(`Account state: ${JSON.stringify(queryAccountResult, null, 2)}`);


        console.log("\n========== Transaction Summary ==========");
        for (const [label, txid] of txIds) {
            console.log(`  ${label}: ${txid}`);
        }
        console.log("Flow completed successfully!");
    } catch (err) {
        console.error("Flow failed:", err);
    }
}

main().catch(console.error);
