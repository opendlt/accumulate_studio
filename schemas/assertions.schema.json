{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://accumulate.network/schemas/assertions.schema.json",
  "title": "Accumulate Studio Assertions v1",
  "type": "object",
  "additionalProperties": false,
  "required": ["assertions"],
  "properties": {
    "assertions": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/assertion" }
    }
  },
  "$defs": {
    "assertion": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "balance.delta",
            "balance.equals",
            "account.exists",
            "account.not_exists",
            "chain.entry_count_delta_min",
            "receipt.verified",
            "tx.status.equals",
            "synthetic.delivered"
          ]
        },
        "account": { "type": "string", "minLength": 1 },
        "delta": {
          "type": "string",
          "minLength": 1,
          "description": "Decimal delta as string, e.g. '+10', '-0.5'."
        },
        "equals": {
          "type": "string",
          "minLength": 1,
          "description": "Decimal expected value as string."
        },
        "url": { "type": "string", "minLength": 1 },
        "chain": { "type": "string", "minLength": 1 },
        "min_delta": { "type": "integer", "minimum": 0 },
        "source_step": {
          "type": "string",
          "minLength": 1,
          "description": "Step id in flow.yaml to reference outputs."
        },
        "txid": { "type": "string", "minLength": 1 },
        "status": { "type": "string", "minLength": 1 },
        "message": {
          "type": "string",
          "description": "Human-readable description."
        }
      },
      "allOf": [
        {
          "if": { "properties": { "type": { "const": "balance.delta" } } },
          "then": { "required": ["account", "delta"] }
        },
        {
          "if": { "properties": { "type": { "const": "balance.equals" } } },
          "then": { "required": ["account", "equals"] }
        },
        {
          "if": { "properties": { "type": { "const": "account.exists" } } },
          "then": { "required": ["url"] }
        },
        {
          "if": { "properties": { "type": { "const": "account.not_exists" } } },
          "then": { "required": ["url"] }
        },
        {
          "if": { "properties": { "type": { "const": "chain.entry_count_delta_min" } } },
          "then": { "required": ["url", "chain", "min_delta"] }
        },
        {
          "if": { "properties": { "type": { "const": "receipt.verified" } } },
          "then": {
            "anyOf": [
              { "required": ["source_step"] },
              { "required": ["txid"] }
            ]
          }
        },
        {
          "if": { "properties": { "type": { "const": "tx.status.equals" } } },
          "then": {
            "required": ["status"],
            "anyOf": [
              { "required": ["source_step"] },
              { "required": ["txid"] }
            ]
          }
        },
        {
          "if": { "properties": { "type": { "const": "synthetic.delivered" } } },
          "then": {
            "anyOf": [
              { "required": ["source_step"] },
              { "required": ["txid"] }
            ]
          }
        }
      ]
    }
  }
}
